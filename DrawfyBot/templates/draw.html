<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚úèÔ∏è Drawfy - –†–∏—Å–æ–≤–∞–Ω–∏–µ</title>
    <link rel="stylesheet" href="../static/css/style.css">
    <style>
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            touch-action: manipulation;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 10px;
            min-height: 100vh;
            color: white;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255, 255, 255, 0.1);
            padding: 15px 20px;
            border-radius: 15px;
            margin-bottom: 15px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .header-title {
            font-size: 1.5em;
            font-weight: bold;
        }
        
        .header-controls {
            display: flex;
            gap: 10px;
        }
        
        .control-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 1.3em;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .control-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }
        
        .control-btn.clear {
            color: #ff4757;
        }
        
        .control-btn.undo {
            color: #ffa502;
        }
        
        .control-btn.save {
            color: #2ed573;
        }
        
        .tools-panel {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 15px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .tools-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
        }
        
        .tool-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }
        
        .tool-label {
            font-size: 0.9em;
            opacity: 0.9;
        }
        
        .color-palette {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .color-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 3px solid rgba(255, 255, 255, 0.5);
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 3px 6px rgba(0,0,0,0.2);
        }
        
        .color-btn:hover {
            transform: scale(1.1);
        }
        
        .color-btn.active {
            border-color: white;
            transform: scale(1.1);
            box-shadow: 0 0 10px rgba(255,255,255,0.5);
        }
        
        .brush-sizes {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .brush-btn {
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            transition: all 0.2s;
        }
        
        .brush-btn.active {
            background: white;
            color: #667eea;
            transform: scale(1.1);
        }
        
        .brush-btn:hover:not(.active) {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .canvas-container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        canvas {
            width: 100%;
            height: 400px;
            background: white;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            display: block;
            cursor: crosshair;
            touch-action: none;
        }
        
        .save-panel {
            background: rgba(255, 255, 255, 0.1);
            padding: 25px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            display: none;
            margin-top: 15px;
        }
        
        .save-panel h3 {
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.4em;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-size: 0.95em;
            opacity: 0.9;
        }
        
        input, textarea {
            width: 100%;
            padding: 14px;
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            font-size: 16px;
            font-family: inherit;
            transition: all 0.3s;
            color: #333;
        }
        
        input:focus, textarea:focus {
            outline: none;
            border-color: white;
            background: white;
            box-shadow: 0 0 10px rgba(255,255,255,0.3);
        }
        
        .button-group {
            display: flex;
            gap: 15px;
        }
        
        .btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        
        .btn-primary {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .btn-primary:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .btn-success {
            background: rgba(46, 213, 115, 0.8);
            color: white;
            border: 2px solid rgba(46, 213, 115, 0.9);
        }
        
        .btn-success:hover {
            background: rgba(46, 213, 115, 1);
            transform: translateY(-2px);
        }
        
        .mode-selector {
            display: flex;
            gap: 10px;
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 12px;
            margin: 15px 0;
            justify-content: center;
        }
        
        .mode-btn {
            flex: 1;
            padding: 12px;
            text-align: center;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95em;
            transition: all 0.2s;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid transparent;
        }
        
        .mode-btn.active {
            background: white;
            color: #667eea;
            font-weight: bold;
            border-color: white;
        }
        
        .mode-btn:hover:not(.active) {
            background: rgba(255, 255, 255, 0.2);
        }
        
        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .nav-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            justify-content: center;
        }
        
        .nav-btn {
            padding: 12px 24px;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 25px;
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s;
            text-align: center;
        }
        
        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .color-btn {
                width: 35px;
                height: 35px;
            }
            
            .brush-btn {
                width: 35px;
                height: 35px;
            }
            
            canvas {
                height: 350px;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .control-btn {
                width: 45px;
                height: 45px;
            }
        }
        
        @media (max-width: 480px) {
            canvas {
                height: 300px;
            }
            
            .tools-row {
                flex-direction: column;
                align-items: stretch;
            }
            
            .color-palette {
                justify-content: center;
            }
        }
        
        /* –ò–∫–æ–Ω–∫–∏ */
        .icon-large {
            font-size: 1.8em;
        }
        
        .instructions {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 15px;
            margin: 15px 0;
            font-size: 0.9em;
            opacity: 0.9;
            border-left: 4px solid rgba(255, 255, 255, 0.3);
        }
    </style>
</head>
<body>
    <!-- –®–∞–ø–∫–∞ -->
    <div class="header">
        <div class="header-title">‚úèÔ∏è Drawfy - –†–∏—Å–æ–≤–∞–Ω–∏–µ</div>
        <div class="header-controls">
            <button class="control-btn undo" onclick="undo()" title="–û—Ç–º–µ–Ω–∏—Ç—å (Ctrl+Z)">‚Ü©Ô∏è</button>
            <button class="control-btn clear" onclick="clearCanvas()" title="–û—á–∏—Å—Ç–∏—Ç—å —Ö–æ–ª—Å—Ç">üóëÔ∏è</button>
            <button class="control-btn save" onclick="showSavePanel()" title="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–∞–±–æ—Ç—É">üíæ</button>
        </div>
    </div>
    
    <!-- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è -->
    <div class="instructions">
        <strong>üí° –ö–∞–∫ —Ä–∏—Å–æ–≤–∞—Ç—å:</strong> –í—ã–±–µ—Ä–∏—Ç–µ —Ü–≤–µ—Ç –∏ —Ä–∞–∑–º–µ—Ä –∫–∏—Å—Ç–∏, –∑–∞—Ç–µ–º —Ä–∏—Å—É–π—Ç–µ –Ω–∞ —Ö–æ–ª—Å—Ç–µ –º—ã—à–∫–æ–π –∏–ª–∏ –ø–∞–ª—å—Ü–µ–º (–Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ).
    </div>
    
    <!-- –ü–∞–Ω–µ–ª—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ -->
    <div class="tools-panel">
        <!-- –†–µ–∂–∏–º—ã —Ä–∏—Å–æ–≤–∞–Ω–∏—è -->
        <div class="mode-selector">
            <div class="mode-btn active" id="drawMode" onclick="setMode('draw')">
                <div class="icon-large">‚úèÔ∏è</div>
                <div>–†–∏—Å–æ–≤–∞–Ω–∏–µ</div>
            </div>
            <div class="mode-btn" id="eraseMode" onclick="setMode('erase')">
                <div class="icon-large">üßΩ</div>
                <div>–õ–∞—Å—Ç–∏–∫</div>
            </div>
        </div>
        
        <!-- –¶–≤–µ—Ç–∞ -->
        <div class="tools-row">
            <div class="tool-group">
                <div class="tool-label">üé® –¶–≤–µ—Ç –∫–∏—Å—Ç–∏:</div>
                <div class="color-palette" id="colorPalette">
                    <!-- –¶–≤–µ—Ç–∞ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                </div>
            </div>
        </div>
        
        <!-- –ö–∏—Å—Ç–∏ -->
        <div class="tools-row">
            <div class="tool-group">
                <div class="tool-label">üñåÔ∏è –†–∞–∑–º–µ—Ä –∫–∏—Å—Ç–∏:</div>
                <div class="brush-sizes">
                    <div class="brush-btn active" data-size="3" onclick="setBrushSize(3)" title="–¢–æ–Ω–∫–∞—è –∫–∏—Å—Ç—å">‚óè</div>
                    <div class="brush-btn" data-size="7" onclick="setBrushSize(7)" title="–°—Ä–µ–¥–Ω—è—è –∫–∏—Å—Ç—å">‚óè</div>
                    <div class="brush-btn" data-size="12" onclick="setBrushSize(12)" title="–¢–æ–ª—Å—Ç–∞—è –∫–∏—Å—Ç—å">‚óè</div>
                    <div class="brush-btn" data-size="20" onclick="setBrushSize(20)" title="–û—á–µ–Ω—å —Ç–æ–ª—Å—Ç–∞—è –∫–∏—Å—Ç—å">‚óè</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- –•–æ–ª—Å—Ç -->
    <div class="canvas-container">
        <canvas id="drawingCanvas"></canvas>
    </div>
    
    <!-- –ü–∞–Ω–µ–ª—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è -->
    <div class="save-panel" id="savePanel">
        <h3>üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–∞–±–æ—Ç—É</h3>
        
        <div class="input-group">
            <label for="drawingTitle">–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã:</label>
            <input type="text" id="drawingTitle" placeholder="–ú–æ—è –∫–∞—Ä—Ç–∏–Ω–∞" maxlength="50">
        </div>
        
        <div class="input-group">
            <label for="drawingDesc">–û–ø–∏—Å–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):</label>
            <textarea id="drawingDesc" placeholder="–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ —Å–≤–æ–µ–π —Ä–∞–±–æ—Ç–µ..." rows="3" maxlength="200"></textarea>
        </div>
        
        <div class="button-group">
            <button class="btn btn-secondary" onclick="hideSavePanel()">–û—Ç–º–µ–Ω–∞</button>
            <button class="btn btn-success" onclick="saveDrawing()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –≥–∞–ª–µ—Ä–µ—é</button>
        </div>
    </div>
    
    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <div class="nav-buttons">
        <a href="index.html" class="nav-btn">üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
        <a href="gallery.html" class="nav-btn">üñºÔ∏è –í –≥–∞–ª–µ—Ä–µ—é</a>
        <a href="shop.html" class="nav-btn">üõí –í –º–∞–≥–∞–∑–∏–Ω</a>
        <a href="profile.html" class="nav-btn">üë§ –í –ø—Ä–æ—Ñ–∏–ª—å</a>
    </div>

    <script>
        // ==================== –ü–ï–†–ï–ú–ï–ù–ù–´–ï ====================
        const canvas = document.getElementById('drawingCanvas');
        const ctx = canvas.getContext('2d');
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ö–æ–ª—Å—Ç–∞
        canvas.width = canvas.offsetWidth;
        canvas.height = 400;
        
        // –û—á–∏—â–∞–µ–º —Ö–æ–ª—Å—Ç –±–µ–ª—ã–º —Ü–≤–µ—Ç–æ–º
        ctx.fillStyle = '#ffffff';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è
        let isDrawing = false;
        let lastX = 0;
        let lastY = 0;
        let currentColor = '#000000';
        let currentBrushSize = 7;
        let currentMode = 'draw'; // 'draw', 'erase'
        let drawingHistory = [];
        let historyIndex = -1;
        
        // –¶–≤–µ—Ç–æ–≤–∞—è –ø–∞–ª–∏—Ç—Ä–∞
        const colors = [
            '#000000', '#ff0000', '#00ff00', '#0000ff',
            '#ffff00', '#ff00ff', '#00ffff', '#ffffff',
            '#ff9500', '#5856d6', '#ff2d55', '#4cd964',
            '#5ac8fa', '#007aff', '#34aadc', '#ffcc00',
            '#8e44ad', '#27ae60', '#e74c3c', '#3498db'
        ];
        
        // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====================
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ü–≤–µ—Ç–æ–≤—É—é –ø–∞–ª–∏—Ç—Ä—É
        function initColorPalette() {
            const palette = document.getElementById('colorPalette');
            palette.innerHTML = '';
            
            colors.forEach(color => {
                const colorBtn = document.createElement('div');
                colorBtn.className = 'color-btn';
                colorBtn.style.backgroundColor = color;
                
                if (color === '#ffffff') {
                    colorBtn.style.border = '3px solid #cccccc';
                }
                
                if (color === currentColor) {
                    colorBtn.classList.add('active');
                }
                
                colorBtn.title = color;
                colorBtn.onclick = () => {
                    setColor(color);
                    setMode('draw');
                };
                palette.appendChild(colorBtn);
            });
        }
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ –∏—Å—Ç–æ—Ä–∏—é
        function saveState() {
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 20 —Å–æ—Å—Ç–æ—è–Ω–∏–π
            drawingHistory = drawingHistory.slice(0, historyIndex + 1);
            drawingHistory.push(canvas.toDataURL());
            historyIndex++;
            
            if (drawingHistory.length > 20) {
                drawingHistory.shift();
                historyIndex--;
            }
        }
        
        // ==================== –§–£–ù–ö–¶–ò–ò –†–ò–°–û–í–ê–ù–ò–Ø ====================
        
        function startDrawing(e) {
            isDrawing = true;
            [lastX, lastY] = [e.offsetX, e.offsetY];
            draw(e); // –ù–∞—á–∏–Ω–∞–µ–º —Ä–∏—Å–æ–≤–∞—Ç—å —Å—Ä–∞–∑—É –¥–ª—è —Ç–æ—á–µ–∫
        }
        
        function draw(e) {
            if (!isDrawing) return;
            
            ctx.beginPath();
            ctx.moveTo(lastX, lastY);
            ctx.lineTo(e.offsetX, e.offsetY);
            
            if (currentMode === 'erase') {
                ctx.strokeStyle = '#ffffff'; // –õ–∞—Å—Ç–∏–∫ = –±–µ–ª—ã–π —Ü–≤–µ—Ç
                ctx.lineWidth = currentBrushSize * 1.5; // –õ–∞—Å—Ç–∏–∫ –Ω–µ–º–Ω–æ–≥–æ –±–æ–ª—å—à–µ
            } else {
                ctx.strokeStyle = currentColor;
                ctx.lineWidth = currentBrushSize;
            }
            
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            ctx.stroke();
            
            [lastX, lastY] = [e.offsetX, e.offsetY];
        }
        
        function stopDrawing() {
            if (isDrawing) {
                saveState();
            }
            isDrawing = false;
        }
        
        // ==================== –ò–ù–°–¢–†–£–ú–ï–ù–¢–´ ====================
        
        function setColor(color) {
            currentColor = color;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
            document.querySelectorAll('.color-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.style.backgroundColor === color || 
                   (color === '#ffffff' && btn.style.backgroundColor === 'rgb(255, 255, 255)')) {
                    btn.classList.add('active');
                }
            });
            
            // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –≤ —Ä–µ–∂–∏–º —Ä–∏—Å–æ–≤–∞–Ω–∏—è
            setMode('draw');
        }
        
        function setBrushSize(size) {
            currentBrushSize = size;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
            document.querySelectorAll('.brush-btn').forEach(btn => {
                btn.classList.remove('active');
                if (parseInt(btn.getAttribute('data-size')) === size) {
                    btn.classList.add('active');
                }
            });
        }
        
        function setMode(mode) {
            currentMode = mode;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
            document.getElementById('drawMode').classList.toggle('active', mode === 'draw');
            document.getElementById('eraseMode').classList.toggle('active', mode === 'erase');
            
            // –ú–µ–Ω—è–µ–º –∫—É—Ä—Å–æ—Ä
            canvas.style.cursor = mode === 'erase' ? 'cell' : 'crosshair';
        }
        
        function clearCanvas() {
            if (confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤–µ—Å—å —Ö–æ–ª—Å—Ç? –í–µ—Å—å —Ä–∏—Å—É–Ω–æ–∫ –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω.')) {
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                saveState();
                showMessage('–•–æ–ª—Å—Ç –æ—á–∏—â–µ–Ω!', 'info');
            }
        }
        
        function undo() {
            if (historyIndex > 0) {
                historyIndex--;
                const img = new Image();
                img.onload = function() {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    ctx.drawImage(img, 0, 0);
                };
                img.src = drawingHistory[historyIndex];
                showMessage('–û—Ç–º–µ–Ω–µ–Ω–æ –ø–æ—Å–ª–µ–¥–Ω–µ–µ –¥–µ–π—Å—Ç–≤–∏–µ', 'info');
            } else if (historyIndex === 0) {
                // –ï—Å–ª–∏ —ç—Ç–æ –ø–µ—Ä–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –æ—á–∏—â–∞–µ–º —Ö–æ–ª—Å—Ç
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                historyIndex = -1;
                drawingHistory = [];
                showMessage('–û—Ç–º–µ–Ω–µ–Ω–æ –≤—Å—ë', 'info');
            } else {
                showMessage('–ù–µ—á–µ–≥–æ –æ—Ç–º–µ–Ω—è—Ç—å', 'warning');
            }
        }
        
        // ==================== –°–û–•–†–ê–ù–ï–ù–ò–ï ====================
        
        function showSavePanel() {
            document.getElementById('savePanel').style.display = 'block';
            document.getElementById('drawingTitle').focus();
        }
        
        function hideSavePanel() {
            document.getElementById('savePanel').style.display = 'none';
        }
        
        function saveDrawing() {
            const title = document.getElementById('drawingTitle').value.trim();
            const description = document.getElementById('drawingDesc').value.trim();
            
            if (!title) {
                showMessage('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã', 'error');
                document.getElementById('drawingTitle').focus();
                return;
            }
            
            // –°–æ–∑–¥–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–∑ canvas
            const imageData = canvas.toDataURL('image/png');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ
            showMessage(`üéâ –†–∞–±–æ—Ç–∞ "${title}" —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!`, 'success');
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É
            document.getElementById('drawingTitle').value = '';
            document.getElementById('drawingDesc').value = '';
            
            // –°–∫—Ä—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å
            hideSavePanel();
            
            // –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º –ø–µ—Ä–µ–π—Ç–∏ –≤ –≥–∞–ª–µ—Ä–µ—é
            setTimeout(() => {
                if (confirm('–•–æ—Ç–∏—Ç–µ –ø–µ—Ä–µ–π—Ç–∏ –≤ –≥–∞–ª–µ—Ä–µ—é, —á—Ç–æ–±—ã –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤–∞—à—É —Ä–∞–±–æ—Ç—É?')) {
                    window.location.href = 'gallery.html';
                }
            }, 1000);
        }
        
        // ==================== –£–¢–ò–õ–ò–¢–´ ====================
        
        function showMessage(text, type = 'info') {
            const colors = {
                'success': '#2ed573',
                'error': '#ff4757', 
                'warning': '#ffa502',
                'info': '#3498db'
            };
            
            // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
            const message = document.createElement('div');
            message.textContent = text;
            message.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${colors[type] || colors.info};
                color: white;
                padding: 15px 20px;
                border-radius: 10px;
                z-index: 1000;
                box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                animation: slideIn 0.3s ease;
            `;
            
            document.body.appendChild(message);
            
            // –£–¥–∞–ª—è–µ–º —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                message.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    document.body.removeChild(message);
                }, 300);
            }, 3000);
        }
        
        // –î–æ–±–∞–≤–ª—è–µ–º –∞–Ω–∏–º–∞—Ü–∏–∏
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
        
        // ==================== –°–û–ë–´–¢–ò–Ø ====================
        
        // –°–æ–±—ã—Ç–∏—è –º—ã—à–∏
        canvas.addEventListener('mousedown', startDrawing);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', stopDrawing);
        canvas.addEventListener('mouseout', stopDrawing);
        
        // –°–æ–±—ã—Ç–∏—è –∫–∞—Å–∞–Ω–∏—è (–¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö)
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            const touch = e.touches[0];
            const rect = canvas.getBoundingClientRect();
            startDrawing({
                offsetX: touch.clientX - rect.left,
                offsetY: touch.clientY - rect.top
            });
        });
        
        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            const touch = e.touches[0];
            const rect = canvas.getBoundingClientRect();
            draw({
                offsetX: touch.clientX - rect.left,
                offsetY: touch.clientY - rect.top
            });
        });
        
        canvas.addEventListener('touchend', stopDrawing);
        
        // –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.key === 'z') {
                e.preventDefault();
                undo();
            }
            if (e.key === 'Delete' || e.key === 'Escape') {
                clearCanvas();
            }
            if (e.key === 's' && (e.ctrlKey || e.metaKey)) {
                e.preventDefault();
                showSavePanel();
            }
        });
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        saveState();
        
        // ==================== –ó–ê–ü–£–°–ö ====================
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('DOMContentLoaded', () => {
            initColorPalette();
            showMessage('–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Drawfy! –í—ã–±–µ—Ä–∏—Ç–µ —Ü–≤–µ—Ç –∏ —Ä–∞–∑–º–µ—Ä –∫–∏—Å—Ç–∏, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Ä–∏—Å–æ–≤–∞—Ç—å.', 'info');
            
            // –ê–¥–∞–ø—Ç–∏—Ä—É–µ–º —Ä–∞–∑–º–µ—Ä —Ö–æ–ª—Å—Ç–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
            window.addEventListener('resize', () => {
                const tempImage = new Image();
                tempImage.src = canvas.toDataURL();
                tempImage.onload = () => {
                    canvas.width = canvas.offsetWidth;
                    ctx.drawImage(tempImage, 0, 0, canvas.width, canvas.height);
                };
            });
        });
    </script>
</body>
</html>